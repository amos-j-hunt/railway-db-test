{% extends "base.html" %}
{% block content %}
<h1 class="page-title">Deck Builder</h1>

<form class="deck-controls" method="get">
  <label>Load Deck:
    <select name="deck_id" class="form-input" onchange="this.form.submit()">
      {% for d in all_decks %}
        <option value="{{ d.id }}" {% if d.id == deck.id %}selected{% endif %}>{{ d.name }}</option>
      {% endfor %}
    </select>
  </label>
  <button class="button" name="action" value="new_deck" formmethod="post">Ôºã New Deck</button>
</form>

<form class="deck-controls" method="post">
  <input type="hidden" name="action" value="rename_deck">
  <label>Deck Name:
    <input class="form-input" name="deck_name" value="{{ deck.name }}">
  </label>
  <button class="button" type="submit">Save</button>
</form>

<form class="deck-controls" method="get">
  <input type="hidden" name="deck_id" value="{{ deck.id }}">
  <input class="form-input" type="text" name="coll_search" placeholder="Search my collection‚Ä¶" value="{{ coll_search }}">
  <button class="button" type="submit">üîç</button>
</form>

<div class="flex-layout">
  <!-- Collection Panel -->
  <section class="panel">
    <h2>My Collection</h2>
    <table class="table">
      <thead><tr><th>Name</th><th>Set</th><th>Finishes</th><th>Qty</th><th>Ôºã</th></tr></thead>
      <tbody>
      {% for e in coll_entries %}
        <tr>
          <td class="tooltip" data-title="{{ e.text|default('') }}">{{ e.name }}</td>
          <td>{{ e.setCode }}</td>
          <td>{{ e.finishes }}</td>
          <td>{{ e.quantity }}</td>
          <td>
            <form method="post" action="{{ url_for('deck_add') }}">
              <input type="hidden" name="deck_id" value="{{ deck.id }}">
              <input type="hidden" name="uuid" value="{{ e.uuid }}">
              <button class="button button--small" type="submit">Ôºã</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- Deck Panel -->
  <section class="panel">
    <h2>{{ deck.name }}</h2>
    {% for cost, items in by_cost %}
      <h3>Cost {{ cost }}</h3>
      <table class="table">
        <thead><tr><th>Name</th><th>Set</th><th>Finishes</th><th>Qty</th><th>Ôºç</th></tr></thead>
        <tbody>
        {% for de, card in items %}
          <tr>
            <td class="tooltip" data-title="{{ card.text|default('') }}">{{ card.name }}</td>
            <td>{{ card.setCode }}</td>
            <td>{{ card.finishes }}</td>
            <td>{{ de.quantity }}</td>
            <td>
              <form method="post" action="{{ url_for('deck_remove') }}">
                <input type="hidden" name="deck_id" value="{{ deck.id }}">
                <input type="hidden" name="uuid" value="{{ de.uuid }}">
                <button class="button button--small" type="submit">Ôºç</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  </section>
</div>
{% endblock %}